<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz Flashcards</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Quiz Flashcards</h1>
<button id="modeToggle">Switch to Quiz Mode</button>
<div id="timer" style="display: none; text-align: center; font-size: 20px; margin-bottom: 20px;"></div>

<!-- START: Favorites Section for Tasks 3.3 and 3.4 -->
<h2>Your Favorite Quizzes</h2>
<div id="favoritesContainer">
    <p>Loading your favorite quizzes...</p>
</div>
<!-- END: Favorites Section -->

<div id="flashcardContainer"></div>
<button id="submitQuiz" style="display: none;">Submit Quiz</button>
<div id="feedback" style="display: none; padding: 10px; background-color: #f9f9f9; border: 1px solid #ccc; margin-top: 20px;"></div>

<!-- Navigation buttons -->
<div class="navigation-buttons">
    <button id="pauseResumeButton">Pause</button>
    <button onclick="window.location.href='form-creation.html'">Create a New Quiz</button>
    <button onclick="window.location.href='quiz-history.html'">Go to Quiz History</button>
    <button id="archiveButton">Archive Quiz to History</button>
</div>

<script>
    let isQuizMode = false;
    let quizTimer;
    let flaggedQuestions = new Set();
    let isPaused = false;
    let remainingTime = 0;

    document.addEventListener("DOMContentLoaded", () => {
        const modeToggle = document.getElementById("modeToggle");
        const timerDisplay = document.getElementById("timer");
        const flashcardContainer = document.getElementById("flashcardContainer");
        const submitQuizButton = document.getElementById("submitQuiz");
        const feedback = document.getElementById("feedback");
        const archiveButton = document.getElementById("archiveButton");
        const pauseResumeButton = document.getElementById("pauseResumeButton");

        // Load Favorites for Tasks 3.3 and 3.4
        loadFavorites();

        function notifyUpcomingDeadlines() {
            fetch('/get-quizzes')
                .then(response => response.json())
                .then(quizzes => {
                    const now = new Date();
                    quizzes.forEach(quiz => {
                        const deadline = new Date(quiz.deadline);
                        if (!isNaN(deadline) && deadline - now > 0 && deadline - now <= 48 * 60 * 60 * 1000) {
                            alert(`Upcoming Deadline: Quiz "${quiz.title}" is due on ${deadline.toLocaleString()}`);
                        }
                    });
                })
                .catch(error => console.error("Error fetching quizzes for deadlines:", error));
        }

        function checkDeadline(quiz) {
            const now = new Date();
            const deadline = new Date(quiz.deadline);
            if (deadline <= now) {
                alert(`The deadline for "${quiz.title}" has passed. You cannot submit this quiz.`);
                return false;
            }
            return true;
        }

        // Favorites Section Functions
        function loadFavorites() {
            const favoritesContainer = document.getElementById("favoritesContainer");
            const bookmarks = getBookmarks();

            if (bookmarks.length === 0) {
                favoritesContainer.innerHTML = "<p>You have no favorite quizzes.</p>";
                return;
            }

            favoritesContainer.innerHTML = ""; // Clear the loading message
            bookmarks.forEach(quizTitle => {
                const quizItem = document.createElement("div");
                quizItem.classList.add("favorite-quiz");
                quizItem.innerHTML = `
                    <p>${quizTitle}</p>
                    <button onclick="goToQuiz('${quizTitle}')">View Quiz</button>
                    <button onclick="removeFromFavorites('${quizTitle}')">Remove</button>
                `;
                favoritesContainer.appendChild(quizItem);
            });
        }

        function getBookmarks() {
            const bookmarks = localStorage.getItem("bookmarkedQuizzes");
            return bookmarks ? JSON.parse(bookmarks) : [];
        }

        function saveBookmarks(bookmarks) {
            localStorage.setItem("bookmarkedQuizzes", JSON.stringify(bookmarks));
        }

        function goToQuiz(quizTitle) {
            alert(`Navigating to quiz: ${quizTitle}`);
        }

        function removeFromFavorites(quizTitle) {
            let bookmarks = getBookmarks();
            bookmarks = bookmarks.filter(bookmark => bookmark !== quizTitle);
            saveBookmarks(bookmarks);
            loadFavorites(); // Refresh the favorites list
        }

        function loadFlashcards() {
            flashcardContainer.innerHTML = ''; // Clear the container

            fetch('/get-quizzes')
                .then(response => {
                    if (!response.ok) throw new Error('Failed to fetch quizzes');
                    return response.json();
                })
                .then(quizzes => {
                    if (quizzes.length === 0) {
                        flashcardContainer.innerHTML = '<p>No quizzes found.</p>';
                        return;
                    }

                    quizzes.forEach((quiz, quizIndex) => {
                        const quizBlock = document.createElement('div');
                        quizBlock.classList.add('quiz-block');

                        quizBlock.innerHTML = `
                            <h3>Quiz ${quizIndex + 1}: ${quiz.title}</h3>
                            <p><strong>Description:</strong> ${quiz.description}</p>
                            <p><strong>Difficulty Level:</strong> ${quiz.difficulty || "Not Specified"}</p>
                            <p><strong>Timer:</strong> ${quiz.timer} minutes</p>
                            <p><strong>Deadline:</strong> ${
                            quiz.deadline ? new Date(quiz.deadline).toLocaleString() : 'No deadline'
                        }</p>
                        `;

                        flashcardContainer.appendChild(quizBlock);
                    });
                })
                .catch(error => {
                    console.error(error);
                    flashcardContainer.innerHTML = '<p>Error loading quizzes. Please try again later.</p>';
                });
        }

        // Event listeners and additional logic
        notifyUpcomingDeadlines(); 
        loadFavorites();
        loadFlashcards();
    });
</script>
</body>
</html>
